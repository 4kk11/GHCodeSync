# GHCodeSync開発メモ

## 2025/4/17 VSCode拡張の初期設定

### 完了タスク
- [x] VSCode拡張の初期設定（実装計画Phase 1: 1-1）
  - プロジェクト構造の作成
  - 依存関係の設定
  - 基本実装の完了

### プロジェクト構造
```
GHCodeSync/
├── src/
│   └── extension.ts      # メイン実装
├── package.json         # 拡張の設定・依存関係
├── tsconfig.json       # TypeScript設定
└── .vscodeignore      # パッケージング除外設定
```

### 実装機能
1. WebSocket通信基盤
   - サーバー接続（ws://localhost:8080）
   - メッセージの送受信
   - エラーハンドリング

2. UI機能
   - ステータスバーでの接続状態表示
   - 情報・エラーメッセージの表示

3. コマンド
   - `GHCodeSync.connect`: Grasshopperへの接続
   - `GHCodeSync.disconnect`: Grasshopperからの切断

## 2025/4/17 Grasshopperプラグイン設定

### 完了タスク
- [x] Grasshopperプラグインプロジェクトの設定（実装計画Phase 1: 1-2）
  - WebSocket機能の実装
  - スクリプトコンポーネント更新機能の実装
  - プラグイン情報の設定

### プロジェクト設定
1. 依存関係
   ```xml
   <PackageReference Include="WebSocketSharp" Version="1.0.3-rc11" />
   <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
   ```

2. プラグイン情報
   - 名前: VSCode Grasshopper Integration
   - バージョン: 0.0.1
   - 説明: VSCodeとGrasshopperのスクリプトコンポーネントを連携

## 2025/4/17 VSCode拡張のコアロジック実装

### 完了タスク
- [x] VSCode拡張のコアロジック実装（実装計画Phase 1: 2-1）
  - エディタ監視機能
  - メッセージ送信機能
  - エラーハンドリング

### 実装機能
1. エディタ監視機能
   ```typescript
   // ファイル保存時の処理
   onDidSaveTextDocument(document => {
       if (document.languageId === 'csharp') {
           // スクリプトの更新処理
       }
   });

   // アクティブエディタの変更検知
   onDidChangeActiveTextEditor(editor => {
       // エディタの切り替え処理
   });
   ```

2. GUID管理機能
   - ファイルとGUIDの紐付けをMapで管理
   - 未設定ファイルへのGUID入力プロンプト
   - 保存時のGUID確認と更新処理

3. エラーハンドリング
   - WebSocket接続エラー
   - メッセージ送受信エラー
   - スクリプト更新エラー
   - 非同期処理エラー

### 次のタスクへの引継ぎ事項

1. 追加検討機能
   - GUIDの永続化（ワークスペース設定への保存）
   - 複数ファイルの同時編集対応
   - スクリプトテンプレートの提供

2. エラーハンドリングの強化
   - 再接続機能の実装
   - エラーメッセージの詳細化
   - ログ機能の実装

3. UI/UX改善案
   - GUIDリストのクイックピック表示
   - コンポーネント名の表示
   - 同期状態の視覚的表示

### 動作確認方法
1. 拡張機能のデバッグ
   ```bash
   # 開発用インスタンスの起動
   F5キーでデバッグ開始

   # テスト手順
   1. C#ファイルを開く
   2. GUIDを設定
   3. ファイルを編集・保存
   4. Grasshopperでの更新を確認
   ```

2. エラーケースのテスト
   - 未接続状態での保存
   - 無効なGUID
   - WebSocket切断
   - 不正なスクリプト