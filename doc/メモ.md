# VSCode-Grasshopper開発メモ

## 2025/4/17 VSCode拡張の初期設定

### 完了タスク
- [x] VSCode拡張の初期設定（実装計画Phase 1: 1-1）
  - プロジェクト構造の作成
  - 依存関係の設定
  - 基本実装の完了

### プロジェクト構造
```
vscode-grasshopper/
├── src/
│   └── extension.ts      # メイン実装
├── package.json         # 拡張の設定・依存関係
├── tsconfig.json       # TypeScript設定
└── .vscodeignore      # パッケージング除外設定
```

### 実装機能
1. WebSocket通信基盤
   - サーバー接続（ws://localhost:8080）
   - メッセージの送受信
   - エラーハンドリング

2. UI機能
   - ステータスバーでの接続状態表示
   - 情報・エラーメッセージの表示

3. コマンド
   - `vscode-grasshopper.connect`: Grasshopperへの接続
   - `vscode-grasshopper.disconnect`: Grasshopperからの切断

## 2025/4/17 Grasshopperプラグイン設定

### 完了タスク
- [x] Grasshopperプラグインプロジェクトの設定（実装計画Phase 1: 1-2）
  - WebSocket機能の実装
  - スクリプトコンポーネント更新機能の実装
  - プラグイン情報の設定

### プロジェクト設定
1. 依存関係
   ```xml
   <PackageReference Include="WebSocketSharp" Version="1.0.3-rc11" />
   <PackageReference Include="Newtonsoft.Json" Version="13.0.3" />
   ```

2. プラグイン情報
   - 名前: VSCode Grasshopper Integration
   - バージョン: 0.0.1
   - 説明: VSCodeとGrasshopperのスクリプトコンポーネントを連携

### 実装機能
1. WebSocketサーバー
   - ポート: 8080
   - エンドポイント: ws://localhost:8080
   - イベント: 接続、切断、メッセージ受信

2. スクリプト更新機能
   - GUIDによるコンポーネント特定
   - SetSource/Textプロパティによる更新
   - コンポーネントの再計算処理

3. メッセージフォーマット
   ```json
   // スクリプト更新リクエスト
   {
       "type": "setScript",
       "target": "COMPONENT_GUID",
       "code": "スクリプト内容",
       "language": "csharp"
   }

   // 更新成功レスポンス
   {
       "type": "scriptUpdated",
       "target": "COMPONENT_GUID",
       "status": "success"
   }

   // エラーレスポンス
   {
       "type": "error",
       "message": "エラーメッセージ"
   }
   ```

### 次のタスクへの引継ぎ事項

#### 未実装の機能
1. WebSocket通信のセキュリティ対策
   - 認証機能
   - SSL/TLS対応

2. エラーリカバリー機能
   - 接続断線時の再接続
   - スクリプト更新失敗時のロールバック

#### 次のタスク（WebSocket基盤）のポイント
1. 安定性の向上
   - 接続状態の監視
   - 定期的なヘルスチェック

2. パフォーマンス最適化
   - 大きなスクリプトの分割送信
   - バッファリング処理

### 参考情報
- WebSocket実装: WebSocketSharp使用
- JSONシリアライズ: Newtonsoft.Json使用
- コンポーネント更新: SetSource/Textプロパティ使用

### 動作確認方法
1. プラグインのビルド
   ```bash
   dotnet build
   ```

2. デバッグ実行
   - Rhinoを起動
   - Grasshopperを開く
   - VSCodeから接続コマンドを実行